<div class="order-history-container">
  <div class="page-header">
    <h1>{{ 'orders.title' | translate }}</h1>
  </div>

  @if (loading) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  @if (!loading && orders.length === 0 && filteredOrders.length === 0) {
    <div class="empty-state">
      <span class="material-icons empty-icon">inventory_2</span>
      <h2>{{ 'orders.noOrders' | translate }}</h2>
      <p>{{ 'navigation.products' | translate }}</p>
      <button class="btn btn-primary" (click)="navigateToCatalog()">
        {{ 'navigation.products' | translate }}
      </button>
    </div>
  }

  @if (!loading && orders.length > 0) {
    <div class="filters-section">
      <div class="filters-container">
        <div class="filter-group">
          <label for="status-filter">{{ 'orders.status' | translate }}:</label>
          <select id="status-filter" [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
            @for (option of getStatusOptions(); track option) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
        <div class="filter-group">
          <label for="date-from">{{ 'orders.dateFrom' | translate }}:</label>
          <input type="date" id="date-from" [(ngModel)]="dateFromFilter" (change)="applyFilters()" class="filter-input">
        </div>
        <div class="filter-group">
          <label for="date-to">{{ 'orders.dateTo' | translate }}:</label>
          <input type="date" id="date-to" [(ngModel)]="dateToFilter" (change)="applyFilters()" class="filter-input">
        </div>
        <button class="btn btn-secondary" (click)="clearFilters()">{{ 'orders.clearFilters' | translate }}</button>
      </div>
    </div>
  }

  @if (!loading && orders.length > 0 && filteredOrders.length === 0) {
    <div class="no-matches">
      <p>{{ 'orders.noMatches' | translate }}</p>
    </div>
  }

  @if (!loading && filteredOrders.length > 0) {
    <div class="orders-list">
      @for (order of filteredOrders; track order) {
        <div class="order-card">
          <div class="order-header">
            <div class="order-info">
              <h3>{{ getOrderTitle(order) }}</h3>
              <span class="order-date">{{ order.createdAt | date: 'medium' }}</span>
              <!-- Show last updated if available -->
              @if (order.updatedAt) {
                <div class="order-updated">
                  <small>{{ 'orders.lastUpdated' | translate }}: {{ order.updatedAt | date: 'short' }}</small>
                </div>
              }
            </div>
            <div class="order-status">
              <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                {{ getTranslatedStatus(order.status) }}
              </span>
            </div>
          </div>
          <div class="order-footer">
            <div class="order-total">
              <span class="total-label">{{ 'products.total' | translate }}:</span>
              <span class="total-amount">{{ order.totalAmount.toFixed(2) }}{{ currencyName ? ' ' + currencyName : '' }}</span>
            </div>
            <button class="btn btn-secondary" (click)="viewOrderDetails(order.id)">
              {{ 'orders.viewDetails' | translate }}
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
