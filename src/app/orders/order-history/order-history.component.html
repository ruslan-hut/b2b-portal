<div class="order-history-container">
  @if (loading) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  @if (!loading && orders.length === 0 && filteredOrders.length === 0) {
    <div class="empty-state">
      <span class="material-icons empty-icon">inventory_2</span>
      <h2>{{ 'orders.noOrders' | translate }}</h2>
      <p>{{ 'navigation.products' | translate }}</p>
      <button class="btn btn-primary" (click)="navigateToCatalog()">
        {{ 'navigation.products' | translate }}
      </button>
    </div>
  }

  @if (!loading && orders.length > 0) {
    <div class="filters-section" [class.expanded]="filtersExpanded">
      <div class="filters-header" (click)="toggleFilters()">
        <div class="filters-title">
          <span class="material-icons filter-icon">filter_list</span>
          <span>{{ 'common.filter' | translate }}</span>
          @if (hasActiveFilters()) {
            <span class="active-filters-badge"></span>
          }
        </div>
        <span class="material-icons expand-icon">{{ filtersExpanded ? 'expand_less' : 'expand_more' }}</span>
      </div>
      @if (filtersExpanded) {
        <div class="filters-container">
          <div class="filter-group">
            <label for="status-filter">{{ 'orders.status' | translate }}:</label>
            <select id="status-filter" [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
              @for (option of getStatusOptions(); track option) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
          </div>
          <div class="filter-group">
            <label for="date-from">{{ 'orders.dateFrom' | translate }}:</label>
            <input type="date" id="date-from" [(ngModel)]="dateFromFilter" (change)="applyFilters()" class="filter-input">
          </div>
          <div class="filter-group">
            <label for="date-to">{{ 'orders.dateTo' | translate }}:</label>
            <input type="date" id="date-to" [(ngModel)]="dateToFilter" (change)="applyFilters()" class="filter-input">
          </div>
          <button class="btn btn-secondary" (click)="clearFilters()">{{ 'orders.clearFilters' | translate }}</button>
        </div>
      }
    </div>
  }

  @if (!loading && orders.length > 0 && filteredOrders.length === 0) {
    <div class="no-matches">
      <p>{{ 'orders.noMatches' | translate }}</p>
    </div>
  }

  @if (!loading && filteredOrders.length > 0) {
    <div class="orders-list">
      @for (order of filteredOrders; track order) {
        <div class="order-card" (click)="viewOrderDetails(order.id)">
          <div class="order-row">
            <span class="order-date">{{ order.createdAt | date: 'shortDate' }}</span>
            <span class="order-number">{{ order.number || order.orderNumber }}</span>
            <span class="order-total">{{ order.totalAmount.toFixed(2) }}{{ currencyName ? ' ' + currencyName : '' }}</span>
            <span class="status-badge" [ngClass]="getStatusClass(order.status)">
              {{ getTranslatedStatus(order.status) }}
            </span>
            <span class="chevron-icon material-icons">chevron_right</span>
          </div>
          @if (order.comment) {
            <div class="order-comment-row">
              <span class="material-icons comment-icon">comment</span>
              <span class="comment-text">{{ order.comment }}</span>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
