<div class="catalog-container">
  @if (viewMode === 'grid') {
    <app-search-bar
      [viewMode]="viewMode"
      [categories]="allCategories"
      [selectedCategory]="selectedCategory"
      [searchQuery]="searchQuery"
      [cartTotal]="getCartTotal()"
      [currencyName]="currencyName"
      (search)="onSearchChange($event)"
      (categoryChange)="onCategoryChange($event)"
    />
  }

  @if (loading) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>{{ 'common.loading' | translate }}</p>
    </div>
  }

  <!-- Grid View -->
  @if (!loading && viewMode === 'grid') {
    <app-product-grid
      [products]="filteredProducts"
      [cartItems]="cartItems"
      [currency]="currency"
      [discount]="currentDiscount"
      [vatRate]="currentVatRate"
      (addToCart)="addToCart($event)"
      (imagePreview)="handleImagePreview($event)"
      (productDetails)="openProductDetails($event)"
    />
  }

  <!-- Bulk Order View -->
  @if (!loading && viewMode === 'bulk') {
    <div class="bulk-view-container">
      <div class="bulk-table-section">
        <!-- Actions Bar -->
        <app-bulk-actions-bar
          [categories]="allCategories"
          [selectedCategory]="selectedCategory"
          [searchQuery]="searchQuery"
          [cartTotal]="getCartTotal()"
          [currencyName]="currencyName"
          (search)="onSearchChange($event)"
          (categoryChange)="onCategoryChange($event)"
        />

        <!-- Desktop Table View -->
        <div class="bulk-table-wrapper bulk-table-desktop">
          <app-bulk-table
            [products]="filteredProducts"
            [cartItems]="cartItems"
            [discount]="currentDiscount"
            [vatRate]="currentVatRate"
            [bulkQuantities]="bulkQuantities"
            [selectedProduct]="selectedProduct"
            (productSelect)="selectProduct($event)"
            (quantityChange)="setBulkQuantity($event.product, $event.quantity)"
          />
        </div>

        <!-- Mobile Card View -->
        <div class="bulk-cards-wrapper bulk-cards-mobile">
          <app-bulk-card-list
            [products]="filteredProducts"
            [cartItems]="cartItems"
            [currency]="currency"
            [discount]="currentDiscount"
            [vatRate]="currentVatRate"
            [bulkQuantities]="bulkQuantities"
            (productSelect)="selectProduct($event)"
            (quantityIncrement)="incrementQuantity($event.productId, $event.product)"
            (quantityDecrement)="decrementQuantity($event.productId, $event.product)"
            (quantityChange)="onMobileQuantityChange($event.productId, $event.product, $event.quantity)"
            (imageClick)="handleBulkImageClick($event)"
          />
        </div>
      </div>

      <!-- Desktop Detail Panel -->
      <app-bulk-detail-panel
        [product]="selectedProduct"
        [priceWithVat]="selectedProduct ? getPriceWithVat(selectedProduct) : 0"
        [originalPrice]="selectedProduct ? getOriginalPriceWithVat(selectedProduct) : 0"
        [hasDiscount]="hasDiscount()"
        [currencyName]="currencyName"
        (cardClick)="handleDetailCardClick()"
      />
    </div>
  }

  <!-- Full-size Image Preview Modal -->
  @if (selectedImageForPreview) {
    <app-image-preview-modal
      [imageUrl]="selectedImageForPreview.url"
      [altText]="selectedImageForPreview.alt"
      (closed)="closeImagePreview()"
    />
  }

  <!-- Product Details Overlay -->
  @if (selectedProductForDetails) {
    <app-product-details-overlay
      [product]="selectedProductForDetails"
      (closed)="closeProductDetails()"
    ></app-product-details-overlay>
  }

  <!-- Pagination Controls -->
  <app-pagination-controls
    [hasMore]="hasMoreProducts"
    [loading]="loadingMore"
    [showScrollToTop]="showScrollToTop"
    [showFloating]="showFloatingShowMore"
    (loadMore)="loadMoreProducts()"
    (scrollToTop)="scrollToTop()"
  />
</div>
