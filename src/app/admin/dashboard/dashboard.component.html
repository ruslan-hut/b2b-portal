<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="store-filter">
      <label for="store-select">Filter by Store:</label>
      <select
        id="store-select"
        [(ngModel)]="selectedStoreUID"
        (change)="onStoreChange()"
        [disabled]="loadingStores"
        class="store-select">
        <option [value]="null">All Stores</option>
        @for (store of stores; track store) {
          <option [value]="store.uid">
            {{ store.name || store.uid }}
          </option>
        }
      </select>
    </div>
  </div>

  @if (loading) {
    <div class="loading">
      Loading statistics...
    </div>
  }

  @if (error) {
    <div class="error">
      {{ error }}
      <button (click)="loadDashboardStats()">Retry</button>
    </div>
  }

  @if (!loading && !error && stats) {
    <div class="stats-grid">
      <!-- Orders Statistics -->
      <div class="stat-card orders-card">
        <h2>Orders</h2>
        <div class="stat-value">{{ getTotalOrders() }}</div>
        <div class="stat-details">
          <div class="stat-item">
            <span class="label">Draft:</span>
            <span class="value">{{ getOrderStatusCount('draft') }}</span>
          </div>
          <div class="stat-item">
            <span class="label">New:</span>
            <span class="value">{{ getOrderStatusCount('new') }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Processing:</span>
            <span class="value">{{ getOrderStatusCount('processing') }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Confirmed:</span>
            <span class="value">{{ getOrderStatusCount('confirmed') }}</span>
          </div>
        </div>
      </div>
      <!-- Clients Statistics -->
      <div class="stat-card clients-card">
        <h2>Clients</h2>
        <div class="stat-value">{{ stats.total_clients }}</div>
        <div class="stat-description">Total registered clients</div>
      </div>
      <!-- Products Statistics -->
      <div class="stat-card products-card">
        <h2>Products</h2>
        <div class="stat-value">{{ stats.total_products }}</div>
        <div class="stat-description">Total products in catalog</div>
      </div>
    </div>
  }

  <div class="discount-scale-section">
    <div class="stat-card discount-scale-card">
      <h2>Discount Scale</h2>
      @if (getSelectedStoreName()) {
        <div class="stat-description">{{ getSelectedStoreName() }}</div>
      }
      
      @if (!selectedStoreUID || selectedStoreUID === 'null') {
        <div class="empty-message">No scale</div>
      } @else if (loadingDiscountScales) {
        <div class="loading-message">Loading discount scales...</div>
      } @else if (discountScales.length === 0) {
        <div class="empty-message">No discount scales configured for this store</div>
      } @else {
        <div class="discount-scale-table-container">
          <table class="discount-scale-table">
            <thead>
              <tr>
                <th>Purchase Threshold</th>
                <th>Discount</th>
                <th>Currency</th>
              </tr>
            </thead>
            <tbody>
              @for (scale of discountScales; track scale.sum_purchase + scale.currency_code) {
                <tr class="discount-scale-row">
                  <td>{{ formatCurrency(scale.sum_purchase) }}</td>
                  <td>{{ formatDiscount(scale.discount) }}</td>
                  <td>{{ scale.currency_code }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
</div>

