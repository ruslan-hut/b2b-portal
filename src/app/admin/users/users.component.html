<div class="users-container">
  <div class="header">
    <h1>Users Management</h1>
    <button class="btn-primary" (click)="createUser()">+ Add User</button>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label>Role:</label>
      <select [(ngModel)]="roleFilter" (change)="onRoleFilterChange()">
        <option *ngFor="let option of roleOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
    <div class="filter-group">
      <label>Search:</label>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Search by username, email, or name"
      />
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading users...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading && !error" class="users-table">
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Name</th>
          <th>Role</th>
          <th>Store UID</th>
          <th>Last Login</th>
          <th>Last Update</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>{{ user.username }}</td>
          <td>{{ user.email || '-' }}</td>
          <td>{{ user.first_name }} {{ user.last_name }}</td>
          <td>
            <span [class]="getRoleClass(user.role)">
              {{ user.role }}
            </span>
          </td>
          <td>{{ user.store_uid || '-' }}</td>
          <td>{{ formatDate(user.last_login) }}</td>
          <td>{{ formatDate(user.last_update) }}</td>
          <td class="actions">
            <button class="btn-edit" (click)="editUser(user)">Edit</button>
            <button class="btn-delete" (click)="deleteUser(user)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="8" class="no-data">No users found</td>
        </tr>
      </tbody>
    </table>

    <div class="pagination" *ngIf="totalPages > 1">
      <button [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">Previous</button>
      <span>Page {{ currentPage }} of {{ totalPages }} ({{ total }} total)</span>
      <button [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">Next</button>
    </div>
  </div>

  <!-- Edit/Create Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="cancelEdit()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>{{ isCreating ? 'Create User' : 'Edit User' }}</h2>
      <form (ngSubmit)="saveUser()">
        <div class="form-group">
          <label>Username *</label>
          <input type="text" [(ngModel)]="editForm.username" name="username" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editForm.email" name="email" />
        </div>
        <div class="form-group">
          <label>{{ isCreating ? 'Password *' : 'Password (leave blank to keep current)' }}</label>
          <input type="password" [(ngModel)]="editForm.password" name="password" [required]="isCreating" />
        </div>
        <div class="form-group" *ngIf="editForm.password">
          <label>Confirm Password</label>
          <input type="password" [(ngModel)]="editForm.confirmPassword" name="confirmPassword" />
        </div>
        <div class="form-group">
          <label>First Name</label>
          <input type="text" [(ngModel)]="editForm.first_name" name="first_name" />
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" [(ngModel)]="editForm.last_name" name="last_name" />
        </div>
        <div class="form-group">
          <label>Role *</label>
          <select [(ngModel)]="editForm.role" name="role" required>
            <option value="admin">Admin</option>
            <option value="manager">Manager</option>
            <option value="user">User</option>
            <option value="client">Client</option>
          </select>
        </div>
        <div class="form-group">
          <label>Store UID</label>
          <input type="text" [(ngModel)]="editForm.store_uid" name="store_uid" />
        </div>
        <div class="form-group">
          <label>Price Type UID</label>
          <input type="text" [(ngModel)]="editForm.price_type_uid" name="price_type_uid" />
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
          <button type="submit" class="btn-save">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

