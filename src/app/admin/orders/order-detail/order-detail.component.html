<div class="order-detail-container">
  <div class="detail-header">
    <button class="btn-back" (click)="goBack()">&larr; Back to Orders</button>
    <h2>Order Details</h2>
  </div>

  <div *ngIf="loading" class="loading">Loading order details...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading && !error && order" class="detail-content">
    <div class="section order-info">
      <h3>Order Information</h3>
      <div class="info-grid">
        <div><strong>Order:</strong> {{ order.number || order.uid }}</div>
        <div><strong>Status: </strong> <span [class]="getStatusClass(order.status)">{{ order.status }}</span></div>
        <div><strong>Total:</strong> {{ order.total | currencyFormat: getCurrency(order.currency_code) }}</div>
        <div><strong>Created:</strong> {{ formatDate(order.created_at) }}</div>
        <div><strong>Updated:</strong> {{ formatDate(order.last_update || order.created_at) }}</div>
        <div *ngIf="order.comment"><strong>Comment:</strong> {{ order.comment }}</div>
      </div>
    </div>

    <div class="section client-info">
      <h3>Client Information</h3>
      <div *ngIf="client; else noClient">
        <div class="info-grid">
          <div><strong>Name:</strong> {{ client.name }}</div>
          <div><strong>Email:</strong> {{ client.email }}</div>
          <div><strong>Phone:</strong> {{ client.phone }}</div>
          <div><strong>Discount:</strong> {{ client.discount || 0 }}%</div>
        </div>
      </div>
      <ng-template #noClient>
        <div class="no-data">Client information not available</div>
      </ng-template>
    </div>

    <div class="section shipping-info">
      <h3>Shipping</h3>
      <div class="info-grid">
        <div><strong>Shipping Address:</strong> {{ order.shipping_address || '-' }}</div>
      </div>
    </div>

    <div class="section items-section">
      <h3>Order Items</h3>
      <table class="items-table">
        <thead>
          <tr>
            <th>SKU</th>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Discount</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of items">
            <td>{{ getProductSKU(item.product_uid) }}</td>
            <td>{{ getProductName(item.product_uid) }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ (item.price/100).toFixed(2) }}</td>
            <td>{{ item.discount | number:'1.2-2' }}</td>
            <td>{{ calculateSubtotal(item) | currencyFormat: getCurrency(order.currency_code) }}</td>
          </tr>
          <tr *ngIf="items.length === 0">
            <td colspan="6" class="no-data">No items found for this order</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Status history section (use same styling as items section) -->
    <div class="section items-section history-section">
      <h3>Status History</h3>
      <table class="items-table history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>User</th>
            <th>Status</th>
            <th>Comment</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let h of history">
            <td>{{ formatDate(h.created_at) }}</td>
            <td>{{ (h.user_firstname || '') + ' ' + (h.user_lastname || '') }}</td>
            <td>{{ h.status }}</td>
            <td>{{ h.comment || '-' }}</td>
          </tr>
          <tr *ngIf="history.length === 0 && !historyLoading">
            <td colspan="4" class="no-data">No history entries</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>
